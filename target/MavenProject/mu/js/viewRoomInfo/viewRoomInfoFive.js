M.define("KeyListener",function(c,b){var f={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40};b.listen=function(l,j,h,m,g){var k,g=g||window,i=a(h);if((i.holdKey||i.keyCode)&&(j==="keydown"||j==="keyup")&&(typeof m==="function")){$(l).bind(j,function(n){if(d(n,i.holdKey)){if(e(n,i.holdKey,i.keyCode)){m.apply(g,arguments)}}})}};function a(h){var i={},g,k,j;if(M.is(h,"String")){g=h.split("+");if(g.length===1){j=$.trim(g[0])}else{if(g.length===2){k=$.trim(g[0]);j=$.trim(g[1])}}if(k){i.holdKey=[];g=k.split(",");M.forEach(g,function(m,l){m=$.trim(m);if(M.indexOf(["ctrl","alt","shift"],m)!==-1&&M.indexOf(i.holdKey,m)===-1){i.holdKey=i.holdKey.concat(m)}});if(i.holdKey.length===0){delete i.holdKey}}if(j){i.keyCode=isNaN(j)?f[j]:parseInt(j,10)}}return i}function d(l,j){var g=true,h;if(M.isArray(j)){for(h=0;h<j.length;h++){var k=j[h]=="ctrl"?(l.ctrlKey||l.metaKey):l[j[h]+"Key"];if(!k){g=false;break}}}return g}function e(l,j,m){var k=true,h,g;if(M.isArray(j)){for(h=0;h<j.length;h++){if(f[j[h]]===l.keyCode){k=false;break}}k=k&&(!m||(m&&l.keyCode===m))}else{k=m&&l.keyCode===m}return k}});M.define("Toggle",function(b,a,c){function d(e){this.context="body";this.trigger=null;this.board=null;this.handler=$.noop;this.triggerHandler=$.noop;this.boardHandler=$.noop;M.mix(this,e);this.inner=false;this.init()}d.prototype={init:function(){if(typeof this.trigger==="string"){$(this.context).delegate(this.trigger,"click",$.proxy(function(e){this.triggerHandler(e);this.inner=true},this))}else{$(this.trigger).click($.proxy(function(e){this.triggerHandler(e);this.inner=true},this))}if(typeof this.board==="string"){$(this.context).delegate(this.board,"click",$.proxy(function(e){this.inner=true},this))}else{$(this.board).click($.proxy(function(e){this.inner=true},this))}$(this.context).click($.proxy(function(e){if(!this.inner){this.handler()}else{this.inner=false}},this))}};c.exports=d});M.define("Select",function(a){var b=a("KeyListener"),d=a("Toggle");function c(f){this.valueBox=null;this.dropTrigger=null;this.dropListCnt=null;this.optionSelector="._j_option";this.selectedClass="_j_selected";this.disabledClass="disabled";M.mix(this,f);this.valueBox=$(this.valueBox);this.dropTrigger=$(this.dropTrigger);this.dropListCnt=$(this.dropListCnt);this.dropListInnerCnt=this.dropListInnerCnt?$(this.dropListInnerCnt):this.dropListCnt;this.value=this.valueBox.data("value")||"";this.input=$('<input type="hidden" name="'+this.valueBox.attr("name")+'" value="'+this.value+'" />').insertAfter(this.valueBox);if(!this.value){this.valueBox.addClass("default")}else{this.valueBox.removeClass("default");var e=this.dropListCnt.find('[data-value="'+this.value+'"]'),g=typeof e.data("text")!="undefined"?e.data("text"):e.text();this.setValueBox({value:this.value,text:g})}this.init()}c.prototype={init:function(){this.setFocusItem();this.bindEvents()},setFocusItem:function(){var e=this.dropListCnt.find(this.optionSelector),f=e.filter('[data-value="'+this.value+'"]');if(!f.length){f=e.first()}if(!f.hasClass(this.selectedClass)){f.siblings().removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f}},bindEvents:function(){var f=this;this.dropTrigger.click($.proxy(this.dropClick,this));this.valueBox.click($.proxy(function(){setTimeout($.proxy(function(){this.dropTrigger.trigger("click")},this),1)},this));b.listen(this.dropTrigger,"keydown","up",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.moveSelect(-1)}g.preventDefault()},this));b.listen(this.dropTrigger,"keydown","down",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.moveSelect(1)}g.preventDefault()},this));b.listen(this.dropTrigger,"keydown","enter",$.proxy(function(g){if(!$(g.currentTarget).hasClass(this.disabledClass)){this.selectItem(this.focusItem)}g.preventDefault()},this));this.dropListCnt.delegate(this.optionSelector,"mouseenter",$.proxy(this.hoverItem,this)).delegate(this.optionSelector,"click",$.proxy(function(g){this.selectItem($(g.currentTarget));g.preventDefault()},this));var e=new d({trigger:this.dropTrigger,board:this.dropListCnt,handler:function(){this.board.hide();M.Event(this).fire("hide")}})},dropClick:function(e){if(!$(e.currentTarget).hasClass(this.disabledClass)){this.dropTrigger.focus();this.drop()}e.preventDefault()},disable:function(){this.dropTrigger.addClass(this.disabledClass)},enable:function(){this.dropTrigger.removeClass(this.disabledClass)},selectItem:function(e){this.setSelect(e);this.dropListCnt.hide();this.dropTrigger.focus();this.valueBox.removeClass("default")},moveSelect:function(g){var f=this.dropListCnt.find(this.optionSelector),h=this.focusItem||f.first(),e=h;if(g===-1){e=h.prev(this.optionSelector);if(!e.length){e=f.last()}}else{if(g===1){e=h.next(this.optionSelector);if(!e.length){e=f.first()}}}this.setSelect(e)},setSelect:function(f){var e=f.data("value"),g=typeof f.data("text")!="undefined"?f.data("text"):f.text();this.focusItem&&this.focusItem.removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f;this.value=e;this.input.val(e);this.setValueBox({value:e,text:g});M.Event(this).fire("change",{data:{value:e}});this.viewFocusItem()},setValueBox:function(e){if(this.valueBox.is("input")){this.valueBox.val(e.text)}else{this.valueBox.text(e.text)}this.valueBox.data("value",e.value)},hoverItem:function(e){var f=$(e.currentTarget);this.focusItem.removeClass(this.selectedClass);f.addClass(this.selectedClass);this.focusItem=f},drop:function(){if(this.dropListCnt.css("display")==="none"){this.dropListCnt.show();this.setFocusItem();this.viewFocusItem();M.Event(this).fire("show")}else{this.dropListCnt.hide();M.Event(this).fire("hide")}},viewFocusItem:function(){if(!this.focusItem.length){return}var g=this.dropListInnerCnt[0],h=g.scrollTop,i=g.clientHeight,e=this.focusItem[0].offsetTop,f=e+this.focusItem.height();if(e<h){this.scroll(e)}else{if(f>(h+i)){this.scroll(f-i)}}},scroll:function(e){this.dropListInnerCnt.scrollTop(e)}};return c});
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */
/*!
 * jQuery Mousewheel 3.1.12
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a}else{a(jQuery)}}}(function(c){var d=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],k=("onwheel" in document||document.documentMode>=9)?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice,j,b;if(c.event.fixHooks){for(var e=d.length;e;){c.event.fixHooks[d[--e]]=c.event.mouseHooks}}var f=c.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener){for(var m=k.length;m;){this.addEventListener(k[--m],l,false)}}else{this.onmousewheel=l}c.data(this,"mousewheel-line-height",f.getLineHeight(this));c.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var m=k.length;m;){this.removeEventListener(k[--m],l,false)}}else{this.onmousewheel=null}c.removeData(this,"mousewheel-line-height");c.removeData(this,"mousewheel-page-height")},getLineHeight:function(m){var i=c(m),n=i["offsetParent" in c.fn?"offsetParent":"parent"]();if(!n.length){n=c("body")}return parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(i){return c(i).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};c.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}});function l(i){var o=i||window.event,u=h.call(arguments,1),w=0,q=0,p=0,t=0,s=0,r=0;i=c.event.fix(o);i.type="mousewheel";if("detail" in o){p=o.detail*-1}if("wheelDelta" in o){p=o.wheelDelta}if("wheelDeltaY" in o){p=o.wheelDeltaY}if("wheelDeltaX" in o){q=o.wheelDeltaX*-1}if("axis" in o&&o.axis===o.HORIZONTAL_AXIS){q=p*-1;p=0}w=p===0?q:p;if("deltaY" in o){p=o.deltaY*-1;w=p}if("deltaX" in o){q=o.deltaX;if(p===0){w=q*-1}}if(p===0&&q===0){return}if(o.deltaMode===1){var v=c.data(this,"mousewheel-line-height");w*=v;p*=v;q*=v}else{if(o.deltaMode===2){var n=c.data(this,"mousewheel-page-height");w*=n;p*=n;q*=n}}t=Math.max(Math.abs(p),Math.abs(q));if(!b||t<b){b=t;if(a(o,t)){b/=40}}if(a(o,t)){w/=40;q/=40;p/=40}w=Math[w>=1?"floor":"ceil"](w/b);q=Math[q>=1?"floor":"ceil"](q/b);p=Math[p>=1?"floor":"ceil"](p/b);if(f.settings.normalizeOffset&&this.getBoundingClientRect){var m=this.getBoundingClientRect();s=i.clientX-m.left;r=i.clientY-m.top}i.deltaX=q;i.deltaY=p;i.deltaFactor=b;i.offsetX=s;i.offsetY=r;i.deltaMode=0;u.unshift(i,w,q,p);if(j){clearTimeout(j)}j=setTimeout(g,200);return(c.event.dispatch||c.event.handle).apply(this,u)}function g(){b=null}function a(m,i){return f.settings.adjustOldDeltas&&m.type==="mousewheel"&&i%120===0}}));if(window.M&&typeof window.M.define=="function"){window.M.define("jq-mousewheel",function(){return jQuery})}M.define("ScrollBar",function(a){a("jq-mousewheel");var c=15;function b(d){this.wrap=null;this.container=null;this.dir=1;this.barTPL='<div style="position:absolute; top:0; right:0; padding:1px"><div style="width:7px; height:100%; background:#bbb"></div></div>';this.maxHeight=0;M.mix(this,d);this.container=$(this.container);this.wrap=$(this.wrap);this.scrollBar=null;this.stopped=false;this.scrollToEnd=false;this.init()}b.prototype={init:function(){if(!this.container.length){M.error("ScrollBar init failed for no scroll container.");return false}this.posDir=this.dir===0?"left":"top";this.lengthDir=this.dir===0?"width":"height";this.scrollScale=this.dir===0?"scrollWidth":"scrollHeight";this.clientScale=this.dir===0?"clientWidth":"clientHeight";this.scrollDir=this.dir===0?"scrollLeft":"scrollTop";this.initWrap();this.bindEvents();this.setted=false},initWrap:function(){this.container.css({position:"relative"});if(this.dir==1){this.container.css({"overflow-y":"hidden"})}else{this.container.css({"overflow-x":"hidden"})}if(this.maxHeight&&!isNaN(this.maxHeight)){this.container.css("max-"+this.lengthDir,this.maxHeight).addClass("maxh")}if(!this.wrap.length){this.container.wrap('<div style="position:relative"></div>');this.wrap=this.container.parent()}else{if(this.wrap.css("position")=="static"){this.wrap.css("position","relative")}}this.createScrollBar();if(this.container.height()>0){this.setScrollBar()}},createScrollBar:function(){this.container[0][this.scrollDir]=0;this.scrollBar=$(this.barTPL).css("opacity",0).appendTo(this.wrap)},bindEvents:function(){this.wrap.bind("mouseenter",$.proxy(this.enterWrap,this)).bind("mouseleave",$.proxy(this.leaveWrap,this)).mousewheel($.proxy(this.rollWrap,this));this.scrollBar.mousedown($.proxy(this.holdBar,this));M.Event(this).on("contentchange",$.proxy(this.checkShowScrollBar,this))},setScrollBar:function(){this.checkShowScrollBar()},setDimension:function(){this.wrapStart=this.wrap.offset()[this.posDir]},checkShowScrollBar:function(){var e=this.container[0];this.wrap.css("height",this.container.height());this.wrapLength=this.dir===0?this.wrap.width():this.wrap.height();this.scrollLength=this.dir===0?e.scrollWidth:e.scrollHeight;this.clientLength=this.dir===0?e.clientWidth:e.clientHeight;var d=e[this.scrollDir];if(this.scrollLength>this.clientLength){this.updateScrollBarLength();this.scrollBar.show();if(d<=this.scrollLength-this.clientLength){this.scroll(d)}else{this.scroll(this.scrollLength-this.clientLength)}}else{this.scrollBar.hide()}},updateScrollBarLength:function(){this.barLength=this.wrapLength*(this.clientLength/this.scrollLength);this.barLength=this.barLength<c?c:this.barLength;this.scrollBar.css((this.dir===0?"width":"height"),this.barLength);this.barLength=this.dir===0?this.scrollBar.outerWidth():this.scrollBar.outerHeight()},enterWrap:function(){if(!this.setted){this.setScrollBar();this.setted=true}this.on=true;this.setDimension();this.scrollBar.stop(true,true).animate({opacity:0.8},300)},leaveWrap:function(){this.on=false;if(!this.holded){this.scrollBar.stop(true,true).animate({opacity:0},300)}},stop:function(){this.stopped=true},start:function(){this.stopped=false},rollWrap:function(f,h){if(this.stopped){return true}var d=this.getScrollUnit(-h*f.deltaFactor);d=d<0?Math.floor(d):Math.ceil(d);var g=0,e=this.container[0][this.scrollDir];if(e+d<0){g=0}else{if(e+d+this.clientLength>this.scrollLength){g=this.scrollLength-this.clientLength}else{g=e+d}}this.scroll(g);if(this.scrollBar.is(":visible")){f.preventDefault();f.stopPropagation()}},getScrollUnit:function(d){if($.browser.msie&&parseInt($.browser.version,10)<9){d=30*d}return d},holdBar:function(d){this.holded=true;this.cursorPosition=this.dir===0?d.clientX:d.clientY;this.startCursorOffset=this.cursorPosition-this.scrollBar.offset()[this.posDir];this.listenMouseMove();d.preventDefault()},listenMouseMove:function(){$(document).bind("mousemove",this.getMoveCursorHandler()).bind("mouseup",this.getReleaseCursorHandler())},stopListenMouseMove:function(){$(document).unbind("mousemove",this.getMoveCursorHandler()).unbind("mouseup",this.getReleaseCursorHandler())},getMoveCursorHandler:function(){if(!this.moveCursorHandler){this.moveCursorHandler=$.proxy(this.moveCursor,this)}return this.moveCursorHandler},getReleaseCursorHandler:function(){if(!this.releaseCursorHandler){this.releaseCursorHandler=$.proxy(this.releaseCursor,this)}return this.releaseCursorHandler},moveCursor:function(i){if(this.holded){var e=this.dir===0?i.clientX:i.clientY,h=e-this.cursorPosition,j=this.cursorPosition-this.startCursorOffset-this.wrapStart,g=e-this.startCursorOffset-this.wrapStart,d=this.cursorPosition+(this.barLength-this.startCursorOffset)-this.wrapStart-this.wrapLength,f=e+(this.barLength-this.startCursorOffset)-this.wrapStart-this.wrapLength;if(g>0&&f<0&&h!==0){this.cursorPosition=e;this.moveScrollBar(h)}else{if(g<=0&&j>0&&h!==0){h=-j;this.cursorPosition=this.cursorPosition+h;this.moveScrollBar(h)}else{if(f>=0&&d<0&&h!==0){h=-d;this.cursorPosition=this.cursorPosition+h;this.moveScrollBar(h)}}}}i.preventDefault()},moveScrollBar:function(e){var f=parseInt(this.scrollBar.css(this.posDir),10),d=this.wrapLength-this.barLength-f;if(e<0&&e>-f||e>0&&e<d){f=f+e}else{if(e<0){f=0}else{if(e>0){f=f+d}}}this.scroll((f/(this.wrapLength-this.barLength))*(this.scrollLength-this.clientLength))},scroll:function(d){this.scrollBar.css(this.posDir,d*(this.wrapLength-this.barLength)/(this.scrollLength-this.clientLength));this.container[0][this.scrollDir]=d;M.Event(this).fire("scroll");if(d===0){M.Event(this).fire("scrollToTop");this.scrollToEnd=true}else{if(d+this.container[0][this.clientScale]>=this.container[0][this.scrollScale]){M.Event(this).fire("scrollToBottom");this.scrollToEnd=true}else{this.scrollToEnd=false}}},scrollLength:function(){return this.container[0][this.scrollDir]},releaseCursor:function(){this.holded=false;this.stopListenMouseMove();if(!this.on){this.scrollBar.stop(true,true).animate({opacity:0},300)}}};return b});M.define("StarRating",function(c,b,d){function a(f){var e=$(f.context||"body"),g=f.starClassPrefix||"star";if(!f.blockSelector||!f.starCountSelector||!f.starItemSelector){M.log("blockSelect, starCountSelector, starItemSelector must be defined");return false}e.delegate(f.starItemSelector,"mouseenter",$.proxy(function(i){var j=$(i.currentTarget),k=j.closest(f.blockSelector),h=j.index();j.closest(f.blockSelector).find(f.starCountSelector).removeClass(function(){var n=this.className.split(/\s+/);for(var l=0,m=n.length;l<m;l++){if(n[l].indexOf(g)===0){return n[l]}}}).addClass(g+(h+1));M.Event(this).fire("enterrating",{star:h+1,block:k,starItem:j})},this));e.delegate(f.blockSelector,"mouseleave",$.proxy(function(h){var j=$(h.currentTarget),k=j.closest(f.blockSelector),i=j.data("star")||0;j.find(f.starCountSelector).removeClass(function(){var n=this.className.split(/\s+/);for(var l=0,m=n.length;l<m;l++){if(n[l].indexOf(g)===0){return n[l]}}}).addClass(g+i);M.Event(this).fire("leaverating",{star:i,block:k,starItem:j})},this));e.delegate(f.starItemSelector,"click",$.proxy(function(i){var j=$(i.currentTarget),k=j.closest(f.blockSelector),h=j.index();k.data("star",h+1);M.Event(this).fire("onrating",{star:h+1,block:k,starItem:j});i.preventDefault()},this))}d.exports=a});M.closure(function(f){var m=f("dialog/Dialog"),i=f("dialog/alert"),b=f("Select"),d=f("ScrollBar"),c=f("StarRating"),n=f("InputListener");var k=0,o=0,e=0,a;M.JApp("common:weng_dialog",function(q){k=q.data("wengid");o=q.data("poiid");a=q.data("source");e=+(q.data("rank")||0);if(k||e>5||e%1!=0){e=0}h()});function h(){M.loadApp("weng_form",null,{poiid:o,wengid:k,source:a,rank:e},function(q){if(q.html){g(q.html)}else{i.pop("åŠ è½½å¤±è´¥")}})}var l;var j;function g(q){l=new m({content:$("#_j_wengdialog").tmpl(),PANEL_CLASS:"pop-reviews",stackable:false,impl:"weng_dialog",layerZIndex:1000});M.Event(l).on("afterhide",function(){M.Event.fire("hide note pop")});l.getPanel().find("._j_weng_form_cnt").html(q);l.show()}function p(){setTimeout(function(){if(!l.destroyed&&l.visible){M.Event(l).fire("resize")}},10)}M.Event.on("weng published",function(q){var r=q.info;M.Event.fire("weng updated",{wengid:r.wengid,poiid:r.poiid,poitype:r.poitype});l&&l.close()});M.Event.on("weng form loaded",p);M.Event.on("weng form add imgs",p);M.Event.on("weng form failed",function(q){l&&l.close()})});